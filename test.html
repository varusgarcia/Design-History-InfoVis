<html>
<head>
  <meta charset="utf-8">
  <title>Design Geschichte InfoVis</title>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>

  <style>
  body, div {
    margin: 0;
    padding: 0;
  }

  svg {
  }

  .axis text {
    font-family: Oxygen;
    font-size: 10px;
  }
  .axis line,
  .axis path {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .node {
    stroke-width: 1.5px;
  }
  .node.target {
    fill: #FFBC73;
    stroke: #FFA340;
  }
  .node.source {
    fill: #62B1D0;
    stroke: #0776A0;
  }

  .link {
    stroke: #999;
    stroke-opacity: .6;
  }
  </style>
</head>

<body>
<script>

  var browserHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
  var browserWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);

  var force = d3.layout.force()
            .charge(-300)
            .linkDistance(100)
            .size([browserHeight, browserWidth]);

  var zoom = d3.behavior.zoom()
            .scaleExtent([0.1, 10])
            .on("zoom", zoomed);

  var svg = d3.select("body").append("svg")
            .attr("width", browserWidth)
            .attr("height", browserHeight)
            .append("g")
            .call(zoom);

 var background = svg.append("rect")
            .attr("width", browserWidth)
            .attr("height", browserHeight)
            .style("fill", "none")
            .style("pointer-events", "all");


  var container = svg.append("g");

  queue()
    .defer(d3.json, 'http://designgeschichte.fh-potsdam.de/nodes')
    .defer(d3.json, 'https://raw.githubusercontent.com/varusgarcia/Design-History-InfoVis/real-database/test-db/connection1.json')
    .await(makeLayout);

  function makeLayout(error, nodesData, edgesData) {
      force.nodes(nodesData.nodes)
              .links(edgesData.edges)
              .start();

      var link = container.append("g")
                          .attr("class", "links")
                          .selectAll(".link")
                          .data(edgesData.edges)
                          .enter().append("line")
                            .attr("class", "link")
                            .style("stroke-width", 4);

      var node = container.append("g")
                            .attr("class", "nodes")
                            .selectAll(".node")
                            .data(nodesData.nodes)
                            .enter().append("g")
                             .attr("class", "node")
                             .attr("cx", function(d) { return d.x; })
                             .attr("cy", function(d) { return d.y; })
                             .attr("id", function (d) { return 'node-' + d.id });
                             //.call(drag);


      node.append("circle")
        .attr("r", function(d) { return d.weight * 2+ 12; })
        .append("title").text(function(d){ return "Name:" + d.name + " " + d.surname +" (ID: " + d.id + " )" })
        //.style("fill", function(d) { return color(1/d.rating); });

      force.on("tick", function() {
        nodesData.nodes.forEach (function(nodePos,i) {
          nodePos.x = i * 15;
        })

        link.attr("x1", function(d) { return d.source.x; })
            .attr("y1", function(d) { return d.source.y; })
            .attr("x2", function(d) { return d.target.x; })
            .attr("y2", function(d) { return d.target.y; });

        node.attr("transform", function(d,i) { return "translate(" + d.x + "," + d.y + ")"; });
      });
  }

  function zoomed() {
    container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
  }
</script>
</body>
</html>
